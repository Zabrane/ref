<html>

<!-- TODO maybe hamburger button switches between simple and detailed navigation? -->
<!-- TODO click on symbol to copy to clipboard -->
<!-- TODO feedback: table of contents, search results (if any), cross-reference pages ("i/o verbs"), "see also" on topic pages, stuff like that -->
<!-- https://chat.stackexchange.com/transcript/message/50039343#50039343 -->

<head>
    <title>k refcard</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="showdown/showdown.min.js"></script>
    <style>
        /* TODO: tap top to scroll to start on mobile */
        body {
            font-family: Consolas, monospace;
            font-size: 12px;
            margin: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            -webkit-text-size-adjust: 100%;
        }
        pre {font-family: Consolas, monospace}
        header {
            background: grey;
            color: white;
            width: 100%;
            padding-top: 0.1em;
            padding-bottom: 0.1em;
            font-size: 1em;
        }
        header #hamburger {
            margin-top: 0.1em;
            margin-bottom: 0.1em;
            margin-left: 8px;
            background-color: grey;
            border: 1px solid white;
            color: white;
        }
        header h1 {
            display: inline-block;
            margin-left: 8px;
            margin-top: 0.1em;
            margin-bottom: 0.1em;
            font-weight: normal;
            font-size: 1em;
        }
        header p {
            /* TODO bit of a hack but fix later */
            vertical-align: middle;
            float: right;
            font-size: 1em;
            margin-right: 8px;
            margin-top: 0.3em;
            margin-bottom: 0.1em;
        }
        header a {
            color: white;
        }
        #container {
            height: 100%;
            display: flex;
            overflow-y: hidden;
        }
        #card {
            display: none;
        }
        #card a {
            /* color: rgb(75, 75, 75); */
        }
        #small-nav {
            display: none;
            margin: 0;
            padding: 12px;
            padding-right: 15px;
            font-size: 1.25em;
            border-bottom: 1px solid black;
            position: fixed;
            background-color: rgb(240, 240, 240);
            border-right: 1px solid black;
            z-index: 2;
        }
        #small-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #detail {
            height: 100%;
            padding-left: 1em;
            padding-right: 1em;
            overflow-y: scroll;
            flex-grow: 1;
            flex-basis: 0;
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
        }
        #detail pre {
            display: inline-block;
            border: 1px solid black;
            padding: 0.25em;
            margin: 0;
            background-color: #9e9e9e1c;
        }
        code {
            padding-left: 0.2em;
            padding-right: 0.2em;
        }
        ul {padding-left: 1.5em}
        table {border-collapse: collapse; font-size: 12px}
        th, td {border: 1px solid black; padding: 0.25em;}
        /* h3 {position: -webkit-sticky; position: sticky; top: 0px; background-color: white;} */
        h2 {padding-top: 0.5em}
        h3 {padding-top: 0.25em; padding-bottom: 0.25em; border-bottom: 1px solid black}
        h3 > code {background-color: #5f5f5f1c;}
        h4 > code {background-color: #5f5f5f1c;}

        @media screen and (min-device-width: 480px) and (min-width: 800px) {
            #small-nav {
                margin-top: 0;
                border-right: 1px solid black;
                border-bottom: 0;
                background-color: none;
                font-size: 1em;
                padding-left: 0.7em;
                position: inherit
            }
            #card {
                display: block;
                overflow-y: auto;
                overflow-x: hidden; /* TODO can we deal with this another way? */
                overscroll-behavior: contain;
                border-right: 1px solid rgba(0,0,0,.1);
                height: 100%;
                padding-left: 1em;
                padding-right: 1em;
            }
        }

    </style>

</head>

<body>

    <script>
        function toggle_menu () {
            const h = document.getElementById("small-nav")
            if (h.getAttribute("style")) {
                h.removeAttribute("style")
            } else {
                h.setAttribute("style", "display: block")
            }
        }
        window.onload = function() {
            const links = document.getElementById("small-nav").querySelectorAll("a");
            links.forEach(function(link) {link.onclick = toggle_menu})
        }
    </script>
    
    <header>
        <!-- TODO make font bigger for mobile? figure out why font size changes for code boxes on mobile? -->
        <button id="hamburger" onclick="toggle_menu()">&equiv;</button><h1>k refcard (unofficial)</h1>
        <p><a href="http://github.com/kparc/ref">Fork me!</a></p>
    </header>
    
    <div id="container">

        <nav id="small-nav" style="display: block;"> <!-- expanded by default
                                                          TODO remember toggle status in permanent cookie
                                                          TODO mobile detection/support
                                                      -->
            <ul>
                <li><a href="#verbs">Verbs</a></li>
                <li><a href="#adverbs">Adverbs</a></li>
                <li><a href="#nouns">Nouns</a></li>
                <li><a href="#many-args">3+ args</a></li>
                <li><a href="#datetime">Datetimes</a></li>
                <li><a href="#tables-ksql">Tables &amp; KSQL</a></li>
                <li><a href="#util">Utilities</a></li>
                <li><a href="#math">Math</a></li>
                <li><a href="#aggr">Aggregations</a></li>
                <li><a href="#io-ipc">IO and IPC</a></li>
                <li><a href="#commands">Commands</a></li>
                <li><a href="#converters">Converters</a></li>
                <li><a href="#.z"><code>.z</code> namespace</a></li>
                <li><a href="#secrets">Secrets!</a></li>
            </ul>
    
            <br>
    
            <ul>
                <li><a href="#faq">FAQ</a></li>
                <li><a href="#shakti-python">shakti-python</a></li>
                <li><a href="#communities">Communities</a></li>
            </ul>

            <br>

            <!-- in desktop, move bar to LHS instead of top. in mobile, make the jumps let you see the heading jumped to, and fix the bar at the top, and make the bar disappear when a link is clicked. -->
            <!-- add how to install k itself (miniconda, rlwrap) -->

            <!-- John Earnest's: -->
            <ul>
                <!-- li><a href="https://github.com/JohnEarnest/ok/blob/gh-pages/docs/Programming.md">Programming</a> (recommended)</li -->
                <li><a href="https://github.com/JohnEarnest/ok/blob/gh-pages/docs/Trees.md">Trees</a></li>
                <!--li><a href="https://github.com/JohnEarnest/ok/blob/gh-pages/docs/Manual.md">Manual</a></li-->
            </ul>

            <br>

            <ul>

                <li><a href="https://shakti.com/tutorial">Official tutorial</a></li>
                <br>
                <li><a href="http://nsl.com">no stinking loops</a></li>
                <br>
                <li><a href="https://github.com/kparc/kcc/blob/master/README.md">k crash course</a></li>

            </ul>

        </nav>

    <div id="card">

        <!-- Clickable help. These words are linked to detailed explanations via JavaScript at the bottom of this page. -->

        <pre id="official-help">$k [-p 1234] [f.k]                           .z.i(pid) .z.x(arg) .z.e(env)     
                                                                
Verb                       Adverb                Noun            Atom List     
:  assign                  '  each               char  " ab"       `c `C       
+  add         flip        /  over               name  ``a`b       `n `N       
-  subtract    negate      \  scan               int   Ø 0 2       `i `I      
*  multiply    first       ': eachprior          float ø 2.3 π ∞   `f `F   
%  divideby    inverse     /: eachright join|sv  date 2019-06-28   `D `D   .z.d
&  min|and     where       \: eachleft split|vs  time 12:34:56.789 `t `T   .z.t
|  max|or      reverse                                                         
<  less        up          System                list (2;3.4;`c)   `l `L       
>  more        down        0: read/write line    dict {a:2;b:`c}   `a `A(table)
=  equal       group       1: read/write byte    step `b 0 3!2 4   `b          
~  match       not         2: read/write data    expr :32+9*f%5    `0          
!  key         enum        3: conn/set (.z.ms)   func {(+/x)%#x}   `1..9       
,  catenate    enlist      4: http/get (.z.mg)                                 
^  except      asc                               \l f.k  load      \h help     
#  take        count       #[t;c;b[;a]] select   \t[:n]x time      \l log      
_  drop        floor       _[t;c;b[;a]] update   \u[:n]x trace                 
?  find        unique      ?[x;i;f[;y]] splice   \v [d]  vars                  
@  index       type        @[x;i;f[;y]] amend    \f [d]  fns                   
.  apply       value       .[x;i;f[;y]] dmend    \lf file \lc char \ll line    
$  cast|pad    string      $[c;t;f]     cond     \cd [d] get[set]  \gr x file  
                                                                                
util: in within bin like find freq prm cmb                                     
math: sqrt sin cos abs [n]log [n]exp [n]rand mod div                           
aggr: count first last min max sum avg var dev med                             
table: [f]asc [f]dsc [f]key [select|update|delete]A by B from T where C        
                                                                                
datetime:YMDHRSTUV+duration:ymdhrstuv; T:.z.D+.z.t; 2019-06-28+2m; day:7 mod   
`year`month`date`hour`minute`second`millisecond`microsecond`nanosecond         
                                                                                
bool: `ascii`utf8                                                              
1way: `p`m`crc`sha`rip`bad   e.g. hash: `sha@"crypto"                          
2way:``j`k`csv`b64`hex`aes   e.g. json: `j?`j@{a:2;b:`c}                       
                                                                                
if[c;..];while[c;..]                                                           
                                                                                
K:key k:key`k1  /public private                                                
K key k key"hi" /verify sign                                                   
"(;)"/:$`x`y`z                                                                 
\\ exit                                                                        
synonyms: count first last min max sum asc</pre>

</div>

<div id="detail"></div>

<script>

    /* DOWNLOAD, CONVERT AND DISPLAY REFCARD DETAIL */
    var converter = new showdown.Converter({tables: true, rawHeaderId: true, customizedHeaderId: true});
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var html = converter.makeHtml(xhttp.responseText);
            detail.innerHTML = html;
        }
    };
    xhttp.open("GET", "https://raw.githubusercontent.com/kparc/ref/master/ref_detail.md", true);
    xhttp.send();

    // Format: string OR [context, text to link, anchor link ID] (latter is for cases where more precise linking is needed)
    links = [
        ".z.x",
        ["Verb", "Verb", "verbs"], "assign", "add", "flip", "divideby", "min", "where", "up", "equal", "group", "match", 
            "not", "enum", "catenate", "key", "take", "drop", "except", "asc", "floor", "find",
            "unique", "index", "apply", "value", "cast", "pad", "string",
        ["Adverb", "Adverb", "adverbs"], "each", "over", "scan", "eachprior", "eachright", "eachleft", "join", "split", "sv", "vs",
        ["Noun", "Noun", "nouns"], "float", "list", "dict", "func", "expr",
        "table",
        ".z.d", ".z.t",
        ["\\h help", "\\h help", "command-h"], ["\\l log", "\\l log", "command-l"], 
            ["\\lf file", "\\lf file", "command-lf"], ["\\lc char", "\\lc char", "command-lc"], ["\\ll line", "\\ll line", "command-ll"],
        "util", ["in within", "in", "in"], "within", "like", "freq", "[f]asc", "[f]dsc", "[f]key",
        "math", "abs", "prm", "cmb", "[n]log", "[n]exp", "[n]rand", "mod",
        "aggr", "med",
        "sql",
        ["0: read/write line", "0: read/write line", "rw-line"], ["1: read/write byte", "1: read/write byte", "rw-byte"], ["2: read/write data", "2: read/write data", "rw-data"], "conn",
        "select", "update", "splice", "amend", "dmend", "cond",
        "bool", "ascii",
        "datetime",
        "1way", ["`p", "`p", "parse"], ["`m`crc", "`m", "matrix"],
        "2way", ["``j`k", "`", "binary"], ["`j", "`j", "json"], ["`k", "`k", "kson"], ["`csv", "`csv", "csv"]
    ]

    // TODO script may break where context for a given change was modified by an earlier change
    const refcard_elem = document.getElementById("official-help")
    let text = refcard_elem.innerHTML;
    for (let i in links) {
        let data = links[i];
        if (typeof data == "string") {
            text = text.replace(data, "<a href=\"#" + data + "\">" + data + "</a>")
        } else {
            text = text.replace(data[0], data[0].replace(data[1], "<a href=\"#" + data[2] + "\">" + data[1] + "</a>"))
        }
    }
    refcard_elem.innerHTML = text;
    
</script>

<!-- misc notes

bad is bitcoin address:
https://groups.google.com/d/msg/shaktidb/0yq21rHOacU/QqgeStO-CgAJ

table generation:
select a:x,b:1+2*x from +[!3]
{;[a:x;b:1+2*x]}' !3
-->

<!--

"`print",

<h3 id="`print"><code>`print</code></h4>

<p>Are all characters in the string printable?</p>
<pre> `print @ "123"
1
 `print @ "123\n"
0
 `print @ "∞"
1</pre>

-->

</body>

</html>
