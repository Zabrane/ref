<html>

<!-- TODO maybe hamburger button switches between simple and detailed navigation? -->
<!-- TODO click on symbol to copy to clipboard -->
<!-- TODO feedback: table of contents, search results (if any), cross-reference pages ("i/o verbs"), "see also" on topic pages, stuff like that -->
<!-- https://chat.stackexchange.com/transcript/message/50039343#50039343 -->

<head>
    <title>k7 docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* TODO: fix smooth scrolling on mobile */
        body {
            font-family: Consolas, monospace;
            font-size: 12px;
            margin: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            -webkit-text-size-adjust: 100%;
        }
        pre {font-family: Consolas, monospace}
        header {
            background: grey;
            color: white;
            width: 100%;
            padding-top: 0.1em;
            padding-bottom: 0.1em;
            font-size: 1em;
        }
        header #hamburger {
            margin-top: 0.1em;
            margin-bottom: 0.1em;
            margin-left: 8px;
            background-color: grey;
            border: 1px solid white;
            color: white;
        }
        header h1 {
            display: inline-block;
            margin-left: 8px;
            margin-top: 0.1em;
            margin-bottom: 0.1em;
            font-weight: normal;
            font-size: 12px
        }
        #container {
            height: 100%;
            display: flex;
            overflow-y: hidden;
        }
        #index {
            display: none;
        }
        #index a {
            /* color: rgb(75, 75, 75); */
        }
        #small-nav {
            display: none;
            margin: 0;
            padding: 0.5em;
            font-size: 1.25em;
            border-bottom: 1px solid black;
            position: fixed;
            background-color: rgb(240, 240, 240);
            border-right: 1px solid black;
            z-index: 2;
        }
        #small-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #detail {
            height: 100%;
            padding-left: 1em;
            padding-right: 1em;
            overflow-y: scroll;
            flex-grow: 1;
            flex-basis: 0;
            overscroll-behavior: contain;
            -webkit-overflow-scrolling: touch;
        }
        #detail pre {
            display: inline-block;
            border: 1px solid black;
            padding: 0.25em;
            margin: 0;
            background-color: #9e9e9e1c;
        }
        code {
            background-color: #5f5f5f1c;
            padding-left: 0.2em;
            padding-right: 0.2em;
        }
        ul {padding-left: 1.5em}
        table {border-collapse: collapse; font-size: 12px}
        th, td {border: 1px solid black; padding: 0.25em;}

        @media screen and (min-device-width: 480px) and (min-width: 800px) {
            #small-nav {
                margin-top: 0;
                border-right: 1px solid black;
                border-bottom: 0;
                background-color: none;
                font-size: 1em;
                padding-top: 0.5em;
                position: inherit
            }
            #index {
                display: block;
                overflow-y: auto;
                overflow-x: hidden; /* TODO can we deal with this another way? */
                overscroll-behavior: contain;
                border-right: 1px solid rgba(0,0,0,.1);
                height: 100%;
                padding-left: 1em;
                padding-right: 1em;
            }
        }

    </style>
</head>

<body>

    <script>
        function toggle_menu () {
            const h = document.getElementById("small-nav")
            if (h.getAttribute("style")) {
                h.removeAttribute("style")
            } else {
                h.setAttribute("style", "display: block")
            }
        }
        window.onload = function() {
            const links = document.getElementById("small-nav").querySelectorAll("a");
            links.forEach(function(link) {link.onclick = toggle_menu})
        }
    </script>

    <header>
        <!-- TODO make font bigger for mobile? figure out why font size changes for code boxes on mobile? -->
        <button id="hamburger" onclick="toggle_menu()">&equiv;</button><h1>k7 community docs (unofficial)</h1>
    </header>
    
    <div id="container">

        <nav id="small-nav">
            <ul>
                <li><a href="#Verb">Verbs</a></li>
                <li><a href="#Adverb">Adverbs</a></li>
                <li><a href="#Noun">Nouns</a></li>
                <li><a href="#multi-args">3+ args</a></li>
                <li><a href="#datetime">Datetimes</a></li>
                <li><a href="#tables-KSQL">Tables &amp; KSQL</a></li>
                <li><a href="#util">Utilities</a></li>
                <li><a href="#math">Math</a></li>
                <li><a href="#aggr">Aggregations</a></li>
                <li><a href="#IO-IPC">IO and IPC</a></li>
                <li><a href="#commands">Commands</a></li>
                <li><a href="#converters">Converters</a></li>
                <li><a href="#.z"><code>.z</code> namespace</a></li>
            </ul>
    
            <br>
    
            <ul>
                <li><a href="#faq">FAQ</a></li>
                <li><a href="#shakti-python">shakti-python</a></li>
                <li><a href="#communities">Communities</a></li>
            </ul>

            <br>

            <!-- in desktop, move bar to LHS instead of top. in mobile, make the jumps let you see the heading jumped to, and fix the bar at the top, and make the bar disappear when a link is clicked. -->
            <!-- add 'cut' (_) -->
            <!-- add how to install k itself (miniconda, rlwrap) -->

            John Earnest's docs:
            <ul>
                <li><a href="https://github.com/JohnEarnest/ok/blob/gh-pages/docs/Programming.md">Programming</a> (recommended)</li>
                <li><a href="https://github.com/JohnEarnest/ok/blob/gh-pages/docs/Trees.md">Trees</a></li>
                <li><a href="https://github.com/JohnEarnest/ok/blob/gh-pages/docs/Manual.md">Manual</a></li>
            </ul>

            <br>

            <ul>
                <li><a href="https://github.com/kelas/kcc">k crash course</a> (recommended)</li>
                <li><a href="https://shakti.com/tutorial">Official tutorial</a></li>
                <li><a href="https://gitlab.com/k7contrib/docs/">Contribute to these docs</a></li>
            </ul>

        </nav>

    <div id="index">

        <!-- Clickable help. These words are linked to detailed explanations via JavaScript at the bottom of this page. -->

        <pre id="official-help">$k [-p 1234] [f.k]                           .z.i(pid) .z.x(arg) .z.e(env)     
                                                                
Verb                       Adverb                Noun            Atom List     
:  assign                  '  each               char  " ab"       `c `C       
+  add         flip        /  over               name  ``a`b       `n `N       
-  subtract    negate      \  scan               int   Ø 0 2       `i `I      
*  multiply    first       ': eachprior          float ø 2.3 π ∞   `f `F   
%  divideby    inverse     /: eachright join|sv  date 2019-06-28   `D `D   .z.d
&  min|and     where       \: eachleft split|vs  time 12:34:56.789 `t `T   .z.t
|  max|or      reverse                                                         
<  less        up          System                list (2;3.4;`c)   `           
>  more        down        0: read/write line    dict {a:2;b:`c}   `a `A(table)
=  equal       group       1: read/write byte    func {(+/x)%#x}   `1..9       
~  match       not         2: read/write data    expr :32+9*f%5    `0          
!  key         enum        3: conn/set (.z.ms)                                 
,  catenate    list        4: http/get (.z.mg)   \h      help      \l log      
^  except      asc                               \l f.k  load                  
#  take        count       #[t;c;b[;a]] select   \t[:n]x time                  
_  drop        floor       _[t;c;b[;a]] update   \u[:n]x trace                 
?  find        unique      ?[x;i;f[;y]] splice   \v [d]  vars                  
@  index       type        @[x;i;f[;y]] amend    \f [d]  fns                   
.  apply       value       .[x;i;f[;y]] dmend    \lf file \lc char \ll line    
$  cast|pad    string      $[c;t;f]     cond     \cd [d] get[set] \gr x f      
                                                                                
util: in within bin like find freq prm cmb                                     
math: sqrt sin cos abs [n]log [n]exp [n]rand                                   
aggr: count first last min max sum avg var dev med                             
table: [f]asc [f]dsc [f]key [select|update|delete]A by B from T where C        
                                                                                
datetime:YMDHRSTUV+duration:ymdhrstuv; T:.z.D+.z.t; 2019-06-28+2m; day:7 mod   
`year`month`date`hour`minute`second`millisecond`microsecond`nanosecond         
                                                                                
bool: `ascii`utf8                                                              
1way: `p`m`crc`sha`rip`bad   e.g. hash: `sha@"crypto"                          
2way:``j`k`csv`b64`hex`aes   e.g. json: `j?`j@{a:2;b:`c}                       
                                                                                
if[c;..];while[c;..]                                                           
                                                                                
K:key k:key`k1  /public private                                                
K key k key"hi" /verify sign                                                   
                                                                                
"(;)"/:$`x`y`z                                                                 
                                                                                
\\ exit                                                                        
synonyms: count first last min max sum asc</pre>

</div>

<div id="detail">

    <!-- TODO make sure 'cast' says you can cast to multiple types. Does dyadic version with array as x cast separate columns to separate types (per CSV)? -->

    <h2 id="Verb">Verbs</h2>

    <p>Force the monadic case by applying a <code>:</code> suffix.</p>

    <p>Force the dyadic case by putting the verb in parentheses:</p>

    <pre> @1
`i
 (@)1
1@</pre>

    <p>Monadic and dyadic versions of a character are <strong>different verbs</strong> - it's not just a case of how many arguments they are called with.</p>

    <p>For example, with a bracket call with one argument, the monadic verb will work fine, while the dyadic verb will project:</p>

    <pre> @:["abc"]
`C
 @["abc"]
"abc"@</pre>

    <p>Project over the first argument by omitting it entirely:</p>

    <pre> @[;1] "abc"
"b"</pre>

    <p>Triadic versions of a verb are the same as the dyadic version (except for <a href="#cond"><code>cond</code></a>):</p>

    <pre> (?) . ("abcb"; "b")
1
 (?) . ("abcb"; 1; "d")
"adbcb"</pre>
            

    <!-- TODO is there a way to force the triadic or tetradic cases without using bracket syntax? -->

    <!-- TODO explore various 'modified assign' methods eg a+:1; a,:1; a[1;2]: 7; a[1 2; 3 4]: (1 2; 3 4) -->

    <h3 id="assign">Assign <code>:</code></h3>

    <p>Where an assignment is used in a function, Shakti <a href="https://groups.google.com/d/msg/shaktidb/zejmh3vxdAg/6uCxAA2aAwAJ">suggest</a> rewriting code like this:</p>

    <pre>f: {a: reusedtempdata; a*a}</pre>

    <p>As this:</p>

    <pre>f: {a*a:reusedtempdata}</pre>

    <p>Or this:</p>

    <pre>f: {{x*x} reusedtempdata}</pre>

    <h3 id="up">Up <code>&lt;</code></h3>

    <pre> &lt; "abracadabra"
0 3 5 7 10 1 8 4 6 2 9
 s@&lt;s: "abracadabra"
"aaaaabbcdrr"</pre>


    <!-- <h3 id="template"></h3><pre></pre> -->
    <h3 id="group">Group <code>=</code></h3>
    <p>With a list, get back the indices at which each unique element appears:
    <pre> ="abracadabra"
a|0 3 5 7 10
b|1 8       
c|,4        
d|,6        
r|2 9</pre>
    <h3 id="enum">Enumerate <code>!</code></h3><pre> !3
0 1 2
 !2 3
0 0 0 1 1 1
0 1 2 0 1 2</pre>

<p>With a negative integer argument, generate an identity matrix:</p>

<pre> !-3
1 0 0
0 1 0
0 0 1</pre>

    <h3 id="key">Key <code>!</code></h3>
    <pre> ! {a:1;b:2}
`a`b</pre>
    <h3 id="except">Except <code>^</code></h3>
    <pre> (!4)^1
0 2 3
 (!4)^1 3
0 2
 "abracadabra" ^ "bc"
"araadara"</pre>

    <h3 id="sort">Sort <code>^</code></h3>

    <pre> :: l: rand 4
0.5594068 0.1751217 0.3652149 0.5086234
 ^l
0.1751217 0.3652149 0.5086234 0.5594068</pre>

    <h3 id="take">Take <code>#</code></h3>

    <pre> 3#"abracadabra"
"abr"</pre>

<p>Given a filter function (returning <code>1</code>s and <code>0</code>s only):</p>
<pre> (2 mod)#!9
1 3 5 7</pre>

    <h3 id="floor">Floor <code>_</code></h3>

    <pre> _ 1.23 -1.23 0
1 -2 0</pre>

    <h3 id="find">Find <code>?</code></h3>

    <pre> 2 3 1 4 0 ? 3
1
 2 3 1 4 0 ? 3 1 0
1 2 4</pre>

    <h3 id="distinct">Distinct <code>?</code></h3>

    <pre> ? "abracadabra"
"abrcd"
 ? ("hi"; 1 2 3; `a`b; 0; "hi"; `a`b; 1 2; 0)
"hi" 
1 2 3
`a`b 
0    
1 2</pre>
    
    <h2 id="Adverb">Adverbs</h2>

    <p>Although unusual, adverbs can be called in similar ways to verbs:</p>

    <pre> '["~",] "abc"
~a
~b
~c
 (' ("~",)) "abc"
~a
~b
~c</pre>

    <h3 id="each">Each <code>'</code></h3>

    <p>Make a function apply to each element of its input lists, rather than the list itself.</p>

    <pre> "~" , "abc"
"~abc"
 "~" ,' "abc"
~a
~b
~c</pre>

    <p>'Each' will apply to pairings of its input lists:</p>
    <!-- TODO better word than 'pairings'? -->

    <pre> "ab" ,' "cd"
ac
bd

 {x,y,z}'["ab";"cd";"ef"]
ace
bdf</pre>

    <h3 id="over">Over <code>/</code></h3>

    <p>n f/x</p>

    <pre> 3 {x+1}/10
13</pre>

    <p>p f/x</p>

    <pre> {4>#x} {x,"k"}/"o"
"okkk"</pre>

    <h3 id="scan">Scan <code>\</code></h3>

    <p>n f\x</p>

    <pre> 3 {x+1}\10
10 11 12 13</pre>

    <p>p f\x</p>

    <pre> {4>#x} {x,"k"}\"o"
"o"   
"ok"  
"okk" 
"okkk"</pre>

    <h3 id="eachprior">Each prior <code>':</code></h3>

    <!-- TODO seeded vs seedless https://github.com/kparc/kcc#typ-cast -->

    <p>The null chosen for the first pairing is of the type of the first member of the list.</p>
    
    <pre> {y,x}': !3
Ø 0
0 1 
1 2  
 {y,x}': 1.0 2.1 4.7
ø 1   
1 2.1  
2.1 4.7
 {y,x}': ("a";1;`ok)
" a"   
("a";1)
(1;`ok)</pre>

    <h3 id="eachright">Each right <code>/:</code></h3>

    <p>Compare to each:</p>

    <pre> "ab" ,' "cd"
ac
bd
 "ab" ,/: "cd"
abc
abd</pre>

    <h3 id="eachleft">Each left <code>\:</code></h3>

    <pre> "ab" ,\: "cd"
acd
bcd</pre>

    <h3 id="join">Join <code>/:</code></h3>

    <p>The following work with <strong>lists of strings</strong>.</p>

    <p>Prepend the separator to <code>/:</code>, <a href="https://groups.google.com/d/msg/shaktidb/FRNnOgPgZWA/so4euXj7AAAJ">without a space in between</a>.</p>

    <pre> "-"/: ("la";"li";"lu";"le";"lo")
"la-li-lu-le-lo"</pre>

    <p>With empty symbol as 'separator', appends a newline to each string and joins:</p>

    <pre> `/: ("ab";"cd")
"ab\ncd\n"</pre>

    <p>With three characters instead of just a separator, prepends/appends the first and last:</p>

<pre> "(;)"/: (,:' "abcd")
"(a;b;c;d)"</pre>

    <h3 id="split">Split <code>\:</code></h3>

    <p>Prepend the separator to <code>\:</code>, <a href="https://groups.google.com/d/msg/shaktidb/FRNnOgPgZWA/so4euXj7AAAJ">without a space in between</a>.</p>

    <pre> "-"\: "la-li-lu-le-lo"
la
li
lu
le
lo</pre>

<p>With empty symbol as 'separator', splits on newlines, including (if present) at the end of the last word:</p>

<pre> `\: "ab\ncd\n"
ab
cd
 `\: "ab\ncd"
ab
cd</pre>
        
    <h3 id="sv">Scalar from vector (sv) <code>/:</code></h3>

    <p>Mnemonic tip: read 'sv' in k evaluation order, ie right to left.</p>

    <p>Convert a vector of numbers from a specified base into base 10:</p>

    <pre> 2 /: 1 0 1 0
10</pre>

    <p>You can also turn a vector in (year, month, day) form into a k date:</p>

<pre> `/: 2019 5 4
2019-05-04</pre>

    <!-- TODO document?  `/: ("ok";"well";"then")
"ok\nwell\nthen\n"
-->

    <h3 id="vs">Vector from scalar (vs) <code>\:</code></h3>

    <p>Mnemonic tip: read 'vs' in k evaluation order, ie right to left.</p>

    <p>Convert a number from base 10 into a specified base:</p>

    <pre> 10 \: 1000
1 0 0 0
 2 \: 10
1 0 1 0</pre>

    <p>You can also turn a k date into a (year, month, day) vector:</p>

<pre> `\: .z.d
2019 5 4</pre>

    <h2 id="Noun">Nouns</h2>

    <!-- TODO is 'space' seen as null for strings? empty symbol for names? -->

    <h3 id="float">Floats</h3>

    <p>All of <code>1.0</code>, <code>.5</code>, <code>1f</code> are valid float literals.</p>

    <h3 id="list">Lists</h3>

    <p><code>(2;3.4;`c)</code> (or any list of atoms, functions etc) can also be written <code>2,3.4,`c</code>:</p>

    <pre> (2;3.4;`c)~2,3.4,`c
1</pre>

    <p>But it breaks down when you include nested lists such as strings:</p>

    <pre> 2,"hi",`c
2  
"h"
"i"
`c</pre>

    <h3 id="func">Functions</h3>

    <p>Functions can call themselves by using their own name in their definition. Naive example:</p>

    <pre>factorial: {$[x<2;1;x*factorial[x-1]]}
 factorial 4
24</pre>

    <p>A function with implicit <code>xyz</code> args can be distinguished from a dict by ensuring the body does not start with an assignment:</p>

    <pre> @{a:1;a*x}
value error: a
 @{;a:1;a*x}   / in scripts, can also be a newline instead of a semicolon
`1</pre>

    <h3 id="expr">Expressions</h3>
    
    <p>Exprs can be executed on tables, eg:</p>

    <pre> t: +`a`b!(1 2 3;4 5 6)
 t :a>1
0 1 1
 t@&t :a>1
a b
- -
2 5
3 6</pre>
        
    <p>Some expr functionality is NYI. For more info, see <a href="https://groups.google.com/d/msg/shaktidb/5N6VjsOBjoA/GjFgeP4yDAAJ">this forum post</a>.</p>

    <h2 id="util">Utilities</h2>

    <h3 id="within"><code>within</code></h3>

    <pre> `p within `A`z
1
 `p within `A`Z
0</pre>

    <h3 id="freq">Frequency histogram</h3>

    <p>Counts of each item in the list.</p>

    <pre> freq "alibaba"
a|3
b|2
i|1
l|1</pre>
    
    <h3 id="find"><code>find</code></h3>

    <!-- TODO add wildcards, regex-like features -->

    <pre> "abracadabra" find "bra"
1 3
8 3</pre>

    <h3 id="[f]asc">Sort ascending <code>asc</code></h3>

    <pre> asc "abracadabra"
"aaaaabbcdrr"</pre>

    <h3 id="[f]dsc">Sort descending <code>dsc</code></h3>

    <pre> dsc "abracadabra"
"rrdcbbaaaaa"</pre>

    <h2 id="math">Math</h2>

    <h3 id="abs">Absolute value <code>abs</code></h3>

    <pre> abs 1.23
1.23
 abs -1.23
1.23</pre>

    <h3 id="prm">Permutations <code>prm</code></h3>

    <p>Generates permutation indices.</p>

    <pre> prm 3
0 1 2
1 0 2
1 2 0
0 2 1
2 0 1
2 1 0</pre>

    <!-- TODO figure out 'f' cases -->

    <h3 id="[n]rand">Random <code>[n]rand</code></h3>

    <pre> rand 3
0.7502717 0.8107001 0.8145892
 3 rand 10
7 3 9</pre>

    <h2 id="aggr">Aggregations</h2>

    <h3 id="med">Median <code>med</code></h3>

    <p>The value in the middle if the data was sorted.</p>
    
    <p>If the count of the data is even, return the value on the right of the middle.</p>

    <pre> med !3
1
 med !4
2
 med 2 3 1
2</pre>

    <h2 id="tables-KSQL">Tables and KSQL</h2>
    
    <h3 id="table">Tables</h3>

    <p>A table is a list of dicts where each dict has the same keys in the same order.</p>
    
    <p>A table can also be considered as a flipped dict of lists, where each list is of equal length.</p>

    <pre>t: ({a:1;b:2};{a:3;b:4})   / Row-wise
u: +`a`b !    (1 3;2 4)    / Col-wise (flipped dict)
v:  `a`b ! /: (1 2;3 4)    / Row-wise, but de-duplicate headers using eachright

/ The tables match:
t~u
t~v

/ Break row-wise over multiple lines:
w: ({a:1;b:2}
    {a:3;b:4})

t~w

/ Break row-wise (condensed row format) over multiple lines:
x: `a`b!/:(1 2
           3 4)

t~x</pre>

<p>You can access rows or columns of the table by indexing using the row number or column key:</p>

<pre>t[1]    / {a:3;b:4}
t[`b]    / 2 4
t[1;`a]  / 3</pre>

<p>Key tables are dictionaries where the rows of one table map to the rows of another table.</p>

<pre>k: ({a:1;c:3}
    {a:4;c:6})
v: ({b:2};{b:5})
kt: k!v
kt   / (+{a:1 4;c:3 6})!+{b:2 5}
@kt  / `a</pre>

<p>You can also use <code>key</code> to set the key columns after creation:</p>

<pre> t: ({a:1;b:2;c:3};{a:4;b:5;c:6})
 tk: `a`c key t
 tk~kt  / 1</pre>

<p>Access rows of the value table by indexing into the keytable:</p>

<pre>kt[{a:4;c:6}]  / {b:5}</pre>

    <h3 id="sql">KSQL</h3>

    <pre> t: ({a:1;b:2};{a:3;b:4})
 update b:a*2 from t
a b
- -
1 2
3 6</pre>

 <p>Note t is not updated in-place:</p>

 <pre> t
a b
- -
1 2
3 4</pre>

<p>Use <code>by</code> to group rows or aggregations:</p>

<pre> :: t: ({a:1;b:2;c:3};{a:2;b:3;c:4};{a:1;b:4;c:5})
a b c
- - -
1 2 3
2 3 4
1 4 5

 select by a from t
a|                    
-|--------------------
1|+{a:1 1;b:2 4;c:3 5}
2|,{a:2;b:3;c:4}

 select sum b by a from t
a|b
-|-
1|6
2|3</pre>

    <h2 id="commands">Commands</h2>

    <h3 id="help">Help <code>\h</code></h3>

    <p>The official help included in the k binary. It's the navigation to this site!</p>

    <h3 id="log">Changelog <code>\l</code></h3>

    <!-- TODO how will we update this? -->

    <p>As at 2019-05-17:</p>

    <pre>20190517                                                       
FIX                                                            
left join(missing),e.g. (+`a`b!(2 3 4;4 5 6)),(+`a!2 4)!+`b!7 8
                                                                
20190508                                                       
+("**";"***") /flip pad                                        
(0>)+/0 1 -1 -1 0 1 1 1 / early exit                           
                                                                
20190506                                                       
recursion                                                      
r:{[a;b;f;g;x]$[x~a;b;f[x]r[a;b;f;g]g x]}                      
r[1;1;*;-1+]4                                                  
1 1(*;-1+)/4                                                   
(3;,2)({y,1_&&/x#'!:'y};1+_sqrt)/100                           
                                                                
NUC                                                            
^x /sort                                                       
=x /sortkey                                                    
PRF                                                            
n^                                                             
!n                                                             
*|:  /composition                                              
,/+: /composition                                              
                                                                
20190504	                                                      
`aes?`aes@"kei" /encrypt&xdecrypt 4GB per second               
freq"alibababa" /frequency histogram 1Billion per second       
                                                                
20190503                                                       
FIX                                                            
select #n by b from +`b!2 2 3 4                                
                                                                
20190501                                                       
v:2 3                                                          
@[`v;0;7]                                                      
PRF                                                            
n^i &lt;x ?x x?y                                                  
                                                                
20190430                                                       
x^y rank sensitive                                             
f#d domain error if f missing                                  
                                                                
20190428                                                       
"Ds"$.z.S        / date,second                                 
1970Y+`t$1.56e12 / unix epoch                                  
                                                                
20190427                                                       
3000000000 (goes to j)                                         
`f$Ø                                                          
12h                                                            
`p?`p"{a:1;b:2 3}"                                             
                                                                
20190426                                                       
u:1970Y;T:.z.T;t:T-u;u+t                                       
\gr "write " k.txt                                             
                                                                
20190425                                                       
\t  calibrate                                                  
`j? whitespace                                                 
                                                                
20190421                                                       
`D$"20190320"                                                  
NUC                                                            
`/:`\:.z.d                                                     
FIX                                                            
"\n"                                                           
                                                                
20190420                                                       
`j?`j .z.T                                                     
`j?"123"                                                       
{ v:1};{"v":1}                                                 
K:key k:key`k1     / public private                            
K key k key"hi"    / verify sign                               
4 7 mod x                                                      
FIX                                                            
`a#t                                                           
                                                                
20190418                                                       
{a:2}   instead of [a:2]                                       
mod/div instead of n! -n!  7 mod .z.d                          
[n]rand instead of n?                                          
"math*"#."\\h"                                                 
\gr math k.txt (200 times faster than \grep math k.txt)        
                                                                
20190415                                                       
\h help                                                        
\l changelog                                                   
!-n identity matrix                                            
. x eval                                                       
`/: sS(string from String)                                     
`\: Ss(String from string)                                     
`ascii`utf8`print ".."                                         
FIX                                                            
-':2 3.4                                                       
.z.T-.z.T                                                      
sum !3   </pre>

    <h2 id="IO-IPC">IO and IPC</h2>

    <h3 id="line">Read/write line <code>0:</code></h3>

    <!-- TODO what about writing to CSV? -->
    <p>Given the following in <code>test.csv</code>:</p>
    <pre>1,ABC,1.23
3,DEF,4567.89</pre>

    <p>We can read it in as lists of type <code>inf</code> respectively and separator <code>,</code>:</p>

    <pre> ("inf";",")0:"test.csv"
1 3         
`ABC`DEF    
1.23 4567.89</pre>

    <p>The filename can be given as <code>`test.csv</code> instead of <code>"test.csv"</code> (one char shorter!).</p>

    <p>We can also write lists of strings to a file (verify output using a text editor):</p>

    <pre> "test.txt" 0: ("hello";"world")</pre>

    <p>And that includes saving tables to CSV, if we first convert the table to a list of strings:</p>

    <pre> "test.csv" 0: `csv @ +{a:1 2; b:3 4}</pre>

    <p>You can also use <code>0:</code> to deserialise in-memory lists of strings with a common separator. <a href="https://groups.google.com/d/msg/shaktidb/vE4ffjndxik/rYF6K78oBQAJ">Arthur's example</a>:</p>

    <pre>  ("ii";"|")0:("2|3";"3|4";"4|5")
2 3 4
3 4 5</pre>

    <p>Keep in mind it's reading the data into columns, not rows. The first row of the console output is the first item in a list of columns.</p>

    <h3 id="byte">Read/write bytes <code>1:</code></h3>

    <pre> "testfile" 1: 0x0123456789abcdef
 1: "testfile"
0x0123456789abcdef</pre>

    <p>You can verify <code>1:</code> works with raw bytes using an external tool:</p>
 
    <pre>$ hexdump -C testfile
00000000  01 23 45 67 89 ab cd ef                           |.#Eg....|
00000008</pre>

    <p>And to break down what's happening in the 'prompt' example from the official tutorial, ie:</p>

    <pre> name: 1: ("" 1: "What is your name? ")
What is your name? Me
 name
"Me"</pre>

    <ul>
        <li>Read from stdin: <code>1: ""</code> or <code>1: `</code>
        <li>Write to stdout: <code>"" 1: "string"</code> or <code>` 1: "string"</code>
        <li><code>x 1: y</code> returns <code>x</code> (<a href="https://groups.google.com/d/msg/shaktidb/DmV2eoSEGHU/eEEOKfjCBQAJ">source</a>)</li>
    </ul>

    <h3 id="data">Read/write data <code>2:</code></h3>

    <pre> "testfile" 2: (1 2 3 4)
 2: "testfile"
1 2 3 4</pre>

    <p>You can see what <code>testfile</code> looks like in bytes with <code>1:</code>:</p>

    <pre> 1: "testfile"
0x000000070400000001000000020000000300000004000000</pre>

    <h3 id="conn">Inter-process communication <code>3:</code> and <code>4:</code></h3>

    <p>Start a k process running with port 1234 (that's <code>k -p 1234</code>).</p>

    <p>Then in another k process, set up a connection to the first k process, send it commands, and get responses:</p>

    <pre>2019-04-18 15:45:55 2core 1gb avx2 © shakti l2.0 test
 conn: 3: 1234
 conn 4: "life: 42"
 conn 4: "life"
42</pre>

    <h2 id="multi-args">3+ arguments</h2>

    <h3 id="select">Select <code>#[t;c;b[;a]]</code></h3>

    <p>Get all rows of <code>t</code> where <code>c</code> is true.</p>

    <pre> t: +`a`b!(1 2 3;4 5 6)
 #[t; :a>1]
a b
- -
2 5
3 6

 / But since there are just two arguments, we can use # as an infix verb:

 t # :a>1
a b
- -
2 5
3 6

 t # :(a>1)&(b<6)
,{a:2;b:5}
 t # :(a>1)&(b<5)
+{a:!0;b:!0}</pre>

    <h3 id="update">Update <code>_[t;c;b[;a]]</code></h3>

    <p>Via <a href="https://groups.google.com/d/msg/shaktidb/77qVfIc5ecU/eSRy8izkAQAJ">Arthur</a>:</p>

    <pre> t:+`b!2 3
 _[t;();`b! :b+1]
b
-
3
4</pre>

    <h3 id="splice">Splice <code>?[x;i;f[;y]]</code></h3>

    <p>Insert <code>y</code> into <code>x</code> at index <code>i</code>.</p>
    
    <p>If an element was at that index before, move it right.</p>

    <pre> ?[!3;2;`abc]
0   
1   
`abc
2  
 ?[!3;2;"abc"]
0  
1  
"a"
"b"
"c"
2  
</pre>

    <h3 id="amend">Amend <code>@[x;i;f[;y]]</code></h3>

    <p>Replace the element at <code>i</code> in <code>x</code> with <code>y</code>.</p>

    <p>To do the update in-place, use the data's name symbol instead of the name directly (<code>`name</code> vs <code>name</code>).</p>

    <pre>v:!3
 @[v;1;7]
0 7 2
 v
!3   / original assignment unchanged
 @[`v;1;7]
`v
 v
0 7 2</pre>

    <h3 id="cond">Cond <code>$[c;t;f]</code></h3>

    <p>If the true expression is returned, the false expression never executes (and vice versa):</p>

    <pre> a:1;b:1
 $[1;a+:1;b+:1]; (a;b)
2 1
 $[0;a+:1;b+:1]; (a;b)
2 2</pre>

    <p><a href="#Verb">Unlike other triadics</a>, triadic <code>$</code> is not the same as dyadic <code>$</code>:</p>

    <pre> ($) . (`n; "a")
`a
 ($) . (1; "a"; "b")
($) . (1; "a"; "b")
    ^
nyi error</pre>

    <p>Simulate a vector cond:</p>

    <pre> {$[x;y;z]}'[1 0 1; "abc"; "def"] 
"aec"</pre>

    <p>Or (modified version of <a href="https://groups.google.com/d/msg/shaktidb/6JLpGPE-bfM/mlAzxcrgAQAJ">Arthur's</a> - no <code>$</code> needed!):</p>

    <pre> {(+(z;y))@'x}[1 0 1;"abc";"def"]
"aec"</pre>

    <h2 id="bool">Boolean checks</h2>

    <h3 id="`ascii"><code>`ascii</code></h4>

    <p>Are all characters in the string in the <a href="https://en.wikipedia.org/wiki/ASCII#Character_set">ASCII set</a>?</p>
    <pre> `ascii @ "123"
1
 `ascii @ "∞"
0</pre>

<h2 id="datetime">Datetimes</h2>

<!-- TODO 

"Ds"$.z.S        / date,second                          
1970Y+`t$1.56e12 / unix epoch 

-->

<p>A datetime looks like this:</p>

<pre> .z.T
2019-05-04T13:13:12.313</pre>

<p>Datetime literals are <a href="https://groups.google.com/forum/#!topic/shaktidb/184DnAJrwKU">designed</a> to match <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format.</p>

<p>Dates start from <code>2024-01-01</code>:</p>

<pre> `D $ 0
2024-01-01</pre>

<p>'0' is Monday. Get the day of the week with <code>7 mod</code>.</p>

<pre> `Mon`Tue`Wed`Thu`Fri`Sat`Sun @ 7 mod 2024-01-01
`Mon</pre>

<p>You can also use duration literals (requires short-form code), and do date arithmetic:</p>

<pre> .z.d
2019-05-04
 .z.d + 2m
2019-07-04</pre>

<p>Datetime and duration names:</p>
<table>
    <tr><th>Long-form duration</th><th>Short-form duration</th><th>Datetime</th></tr>
    <tr><td>`year</td><td>`y</td><td>`Y</td></tr>
    <tr><td>`month</td><td>`m</td><td>`M</td></tr>
    <tr><td>`date</td><td>`d</td><td>`D</td></tr>
    <tr><td>`hour</td><td>`h</td><td>`H</td></tr>
    <tr><td>`minute</td><td>`r</td><td>`R</td></tr>
    <tr><td>`second</td><td>`s</td><td>`S</td></tr>
    <tr><td>`millisecond</td><td>`t</td><td>`T</td></tr>
    <tr><td>`microsecond</td><td>`u</td><td>`U</td></tr>
    <tr><td>`nanosecond</td><td>`v</td><td>`V</td></tr>
</table>

<p>Convert to/from/between datetimes and durations using <code>$</code>. It takes a name or string (short version only):</p>

<pre> `year $ .z.t
2019y
 `y  $ 2019
2019y
 "y" $ 2019
2019y</pre>

<p>Convert between dates and year, month date digits using <a href="#sv"><code>`/:</code></a> and <a href="#vs"><code>`\:</code></a>.</p>

<h3 id=".z.d">Current date <code>.z.d</code></h3>
<pre>.z.d / 2019-04-02</pre>

<h3 id=".z.t">Current time <code>.z.t</code></h3>
<p>Greenwich Mean Time.</p>

<pre>.z.t / 11:18:14.857</pre>

<h2 id="converters">Converters</h2>

<h3 id="1way">One-way conversions</h3>

<p>Convert to with <code>`x@data</code> or <code>`x data</code>, where <code>`x</code> is the relevant name.</p>

<!-- TODO workdays? -->

<h4>Parse <code>`p</code></h4>

<pre> `p @ "5*!3"
*     
5     
(!:;3)</pre>

<p>A parse tree can be executed with <code>.</code>:</p>

<pre> . `p @ "5*!3"
0 5 10</pre>

<p>Although parse trees can be converted into strings with <code>`p ?</code>, it is not a lossless conversion.</p>

<p>The parser enlists names (and lists of names) to indicate they should not be evaluated.</p>

<p>Examples:</p>

<pre> e: ("1;.1;`n;\"c\";1 2;1. 2.;`n`o;\"chars\";v;1+2;+/1 2;{x+2y};a:1;:a+2b;/comment;\\h")
 {{string: x; parsetree: `p x; type: @ `p x}}' ";"\: e
string   parsetree    type
-------- ------------ ----
1        1            i   
.1       0.1          f   
`n       ,`n          N   
"c"      "c"          c   
1 2      1 2          I   
1. 2.    1 2f         F   
`n`o     ,`n`o            
"chars"  "chars"      C   
v        `v           n   
1+2      (+;1;2)          
+/1 2    ((/;+);1 2)      
{x+2y}   {x+2y}       1   
a:1      (::;`a;1)        
:a+2b    :a+2b        0   
/comment (/;`comment)     
\h       (\;`h)</pre>

<!-- TODO: add IO functions like -p, .z.ms, .z.mg -->

<h4>Matrix display <code>`m</code></h4>

<pre>d: 1 2 3
d
1 2 3
`m d
1
2
3</pre>

    <h3 id="2way">Two-way conversions</h3>

    <p>Convert to with <code>`x@data</code> or <code>`x data</code>, where <code>`x</code> is the relevant name.</p>

    <p>Convert from with <code>`x?serialdata</code>.</p>

    <h4>Binary <code>`</code></h4>
    <pre> ` "a"
0x0161
 ` `a
0x0f6100
 ` 10
0x070a000000</pre>

    <h4>JSON <code>`j</code></h4>

    <pre> `j ({a:1;b:2};{a:"x";b:`z})
"[{\"a\":1,\"b\":2},{\"a\":\"x\",\"b\":\"z\"}]"</pre>

    <h4>KSON <code>`k</code></h4>

    <pre> `k 2*!3
"0 2 4"
 `k ({a:1;b:2};{a:"x";b:`z})
"+{a:(1;\"x\");b:(2;`z)}"</pre>

<h2 id="faq">FAQ</h2>

<h4>How do I see the output of an assignment expression?</h4>

<p>Use the identity function, <code>::</code>:</p>

<pre> a:1+2  / no output
 :: a:1+2
3
 @(::)
`1</pre>

<h4>How do I make an empty typed list?</h4>

<p>For characters, it's just <code>""</code>:</p>

<pre> #""
0
 @""
`C</pre>

<p>For integers and floats, use <code>!</code>:</p>

<pre> @!0
`I
 #!0
0
 @!.0
`F
 #!.0
0</pre>

<p>For other types, take 0 elements from a list of that type (may be a better way?). For names:</p>

<pre> 0#(,`)

 @0#(,`)
`N
 #0#(,`)
0</pre>


<h2 id=".z"><code>.z</code> namespace</h2>

<h3 id=".z.x"><code>.z.x</code></h3>

<p>In the REPL, contains an empty list by default:</p>

<pre>(base) chris@chris-VirtualBox:~/sheet$ k
2019-04-28 15:03:42 2core 1gb avx2 © shakti l2.0 test
 .z.x
()</pre>

<p>But in a file, it lists the filename and any args after it. If <code>testarg.k</code> comprises the line <code>.z.x</code>:</p>

<pre>(base) chris@chris-VirtualBox:~/sheet$ k testarg.k not.a.real.file
2019-04-28 15:03:42 2core 1gb avx2 © shakti l2.0 test
testarg.k      
not.a.real.file</pre>

<p>Therefore, <code>.z.x</code> can be used to pass arguments to a k script.</p>

<p>Also, note those arguments won't appear if we load <code>testarg.k</code> in another k process:</p>

<pre>(base) chris@chris-VirtualBox:~/sheet$ k
2019-04-28 15:03:42 2core 1gb avx2 © shakti l2.0 test
\l testarg.k
()</pre>

<p>So you can also use <code>.z.x</code> to identify whether a script was run in its own right, or merely <code>\l</code>-ed into another k process.</p>

<!-- TODO suggestions: summary of date handling, maybe some crypto examples would be interesting, differences from q (a complex subject) -->
<!-- TODO https://groups.google.com/d/msg/shaktidb/UKZcbwN-qiA/i3LtReSPCwAJ -->
<!-- TODO file and network i/o would be cool too :) -->
<!-- TODO bringing in typed cols from CSVs -->
<!-- TODO stuff from changelog that's not in help -->

<h2 id="shakti-python">shakti-python</h2>

<!-- TODO document: (1) shakti.o does not convert arbitrary python in a way that is necessarily intuitive (eg strings eval to k names); (2) bytestrings; (3) explicit type converters -->

<h3>Install</h3>

<p>One way to install shakti-python is to use <a href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html">Miniconda</a>.</p>

<p>To install Miniconda under Ubuntu 18.04:</p>
<ul>
    <li>Download the Miniconda installer for Python 3, 64-bit (<a href="https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh">direct link</a>)</li>
    <li>In a terminal in your download directory, run:<br><code>bash Miniconda3-latest-Linux-x86_64.sh</code>
</ul>

<p>Once Miniconda is installed, open a new terminal and run:<br><code>conda install -c shaktidb shakti-python</code>.</p>
<p>Then to get to shakti-python, at the prompt, run <code>python</code> <br>(or if you chose to not update your .bashrc, <code>~/miniconda3/bin/python</code>).</p>

<p>Type <code>help('shakti')</code> at the Python prompt to view the package help.</p>

<h3>Examples</h3>

<pre>(base) chris@chris-VirtualBox:~$ python
Python 3.7.1 (default, Dec 14 2018, 19:28:38) 
[GCC 7.3.0] :: Anaconda, Inc. on linux
Type "help", "copyright", "credits" or "license" for more information.
>>>      
>>> import shakti
>>> 
>>> # Execute k commands:
... a = shakti.k("!3")
>>> a
k('!3')
>>> 
>>> a.  # press tab twice for auto-completion (have truncated output)
a.append(    a.cat(       a.distinct(  a.eq(        a.first(     a.group( ...
a.apply(     a.clear(     a.dsc(       a.eval(      a.flip(      a.iasc(  ...
a.asc(       a.count(     a.enlist(    a.extend(    a.floor(     a.idesc( ...
>>> 
>>> # shakti functions and object methods can take Python objects directly:
... a.cat((1, 2, 3))
k('0 1 2 1 2 3')
>>> b = a.cat((1, 2, 3)).where
>>> b
k('1 2 2 3 4 4 5 5 5')
>>> sum(b)
k('31')
>>>
>>> # User-facing module API:
... shakti.__all__
['q', 'k', 'o', 'flip', 'neg', 'sqrt', 'enum', 'parse', 'where', 'reverse',
'count', 'first', 'last', 'sum', 'min', 'max', 'avg', 'var', 'iasc', 'idesc',
'group', 'not_', 'enlist', 'null', 'floor', 'string', 'distinct', 'type_',
'eval_', 'apply', 'at', 'rand', 'find', 'cast', 'take', 'shape', 'match',
'cat', 'drop', 'cut', 'log', 'exp', 'sin', 'cos', 'first', 'last', 'error',
'Ø', 'ø', 'inf', 'show']
>>> 
>>> # Convert Python objects to k:
... shakti.o(range(10))
k('!10')
>>> # o is equivalent to k's identity function:
... shakti.o == shakti.k('::')
True
>>>
>>> # Add globals to k:
... shakti.q.a = [1,2,3]
>>> shakti.k("a*2")
k('2 4 6')
>>> shakti.q.a * 2
k('2 4 6')
>>>
>>> # REPL: shakti.k_repl(), or just...
... /
 +/ 1 2 3
6
 \\
>>></pre>

<p>shakti-python also lets you do some things that k doesn't:</p>
<ul>
    <li><a href="https://groups.google.com/d/msg/shaktidb/etsXDI9J4o4/HmefTXyBAwAJ">Delete globals</a> (at your peril!)</li>
    <li><a href="https://groups.google.com/d/msg/shaktidb/lQ3XSvFPDhw/DOlmmFgHDAAJ">Catch errors</a></li>
</ul>

<h2 id="communities">Communities</h2>
<ul>
    <li><a href="https://groups.google.com/forum/#!forum/shaktidb">shakti google group</a> (official - for 'how to' queries)</li>
    <li><a href="https://chat.stackexchange.com/rooms/90748/the-k-tree">the k tree</a> <br>  write access: email <code>".@acegiklmnort"@7 13 12 4 4 0 10 5 10 1 5 9 2 6 8 0 3 11 9</code></li>
    <li><a href="https://www.reddit.com/r/apljk/">r/apljk</a></li>
</ul>

</div>

<script>

    const raw_elem = document.getElementById("official-help")
    function makeLink(word) {
        return "<a href=\"#" + word + "\">" + word + "</a>"
    }

    links = [].concat( 
        [".z.x"],
        ["Verb", "assign", "up", "group", "enum", "key", "take", "except", "sort", "floor", "find", "distinct"],
        ["Adverb", "each", "over", "scan", "eachprior", "eachright", "eachleft", "join", "split", "sv", "vs"],
        ["Noun", "float", "list", "func", "expr"],
        ["table"],
        [".z.d", ".z.t"],
        ["help", "log"],
        ["util", "within", "freq", "[f]asc", "[f]dsc"],
        ["math", "abs", "prm", "[n]rand"],
        ["aggr", "med"],
        ["sql"],
        ["line", "byte", "data", "conn"],
        ["select", "update", "splice", "amend", "cond"],
        ["bool", "`ascii"],
        ["datetime"],
        ["1way", "2way"]
    )

    // TODO figure out to add doubles like `find`
    for (let i in links) {
        const w = links[i]
        raw_elem.innerHTML = raw_elem.innerHTML.replace(w, makeLink(w))
    }
    
</script>

<!-- misc notes

bad is bitcoin address:
https://groups.google.com/d/msg/shaktidb/0yq21rHOacU/QqgeStO-CgAJ

table generation:
select a:x,b:1+2*x from +[!3]
{;[a:x;b:1+2*x]}' !3
-->

<!--

"`print",

<h3 id="`print"><code>`print</code></h4>

<p>Are all characters in the string printable?</p>
<pre> `print @ "123"
1
 `print @ "123\n"
0
 `print @ "∞"
1</pre>


-->

</body>

</html>
