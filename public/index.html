<html>

<head>
    <title>k7 docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Consolas, monospace;
            font-size: 12px;
            margin: 0;
        }
        pre {font-family: Consolas, monospace}
        header {
            background: grey;
            color: white;
            width: 100%;
            padding-top: 0.1em;
            padding-bottom: 0.1em;
            font-size: 1em;
            position: fixed;
        }
        header #hamburger {
            margin-left: 8px;
            background-color: grey;
            border: 1px solid white;
            color: white;
        }
        header h1 {
            display: inline-block;
            margin-left: 8px;
            margin-top: 0;
            margin-bottom: 0;
            font-weight: normal;
            font-size: 12px
        }
        header p {
            display: inline-block;
            text-align: right;
            margin: 0;
            margin-right: 8px;
        }
        header a {
            color: white;
        }
        #index {
            padding-left: 1em;
            padding-right: 1em;
            display: none;
        }
        #index a {
            /* color: rgb(75, 75, 75); */
        }
        #small-nav {
            display: none;
            margin: 0;
            padding: 0.5em;
            font-size: 1.5em;
            border-bottom: 1px solid black;
        }
        #small-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        #detail {
            padding-left: 1em;
            padding-right: 1em;
        }
        #detail h2 {
            padding-top: 0.5em;
        }
        #detail pre {
            display: inline-block;
            border: 1px solid black;
            padding: 0.25em;
            margin: 0;
            margin-bottom: 0.5em;
            background-color: #9e9e9e1c;
        }
        code {
            background-color: #5f5f5f1c;
            padding-left: 0.2em;
            padding-right: 0.2em;
        }
        h3 {padding-top: 0.5em; margin-top: 0.5em}
        h4 {margin-top: 0.5em}
        ul {padding-left: 1.5em}

        @media screen and (min-device-width: 480px) and (min-width: 800px) {
            body {
                height: 100%;
                display: flex;
                flex-direction: column;
            }
            header {
                position: inherit;
            }
            #container {
                margin-top: 0;
                display: flex;
                overflow: auto;
            }
            #small-nav {
                margin-top: 0;
                border-right: 1px solid black;
                border-bottom: 0;
                background-color: none;
                font-size: 1em;
                padding-top: 0.5em;
            }
            #index {
                display: block;
                overflow-y: scroll;
            }
            #detail {
                overflow-y: scroll;
                flex-grow: 1;
                flex-basis: 0;
            }
        }

    </style>
</head>

<body>

    <script>
    function toggle_menu () {
        const h = document.getElementById("small-nav")
        if (h.getAttribute("style")) {
            h.removeAttribute("style")
        } else {
            h.setAttribute("style", "display: block")
        }
    }
    </script>

    <header>
        <!-- fix at top for mobile + desktop? make font bigger for mobile? -->
        <button id="hamburger" onclick="toggle_menu()">&equiv;</button><h1>k7 community docs (unofficial)</h1>
        <div id="small-nav">
            <ul>
                <li><a href="#verbs">Verbs</a></li>
                <li><a href="#adverbs">Adverbs</a></li>
                <li><a href="#multi-args">3+ args</a></li>
                <li><a href="#datetimes">Datetimes</a></li>
                <li><a href="#tables-KSQL">Tables &amp; KSQL</a></li>
                <li><a href="#util-math-aggr">Util, math, aggr</a></li>
                <li><a href="#IO-IPC">IO and IPC</a></li>
                <li><a href="#commands">Commands</a></li>
                <li><a href="#converters">Converters</a></li>
            </ul>
    
            <br>
    
            <ul>
                <li><a href="#faq">FAQ</a></li>
                <li><a href="#shakti-python">shakti-python</a></li>
                <li><a href="https://shakti.com/tutorial">Tutorial</a></li>
                <li><a href="#communities">Communities</a></li>
                <li><a href="https://gitlab.com/k7contrib/docs/">Contribute</a></li>
            </ul>
        </div>
    </header>
    

    <div id="container">

    <div id="index">

        <!-- Clickable help. These words are linked to detailed explanations via JavaScript at the bottom of this page. -->

        <pre id="official-help">$k [-p 1234] [f.k]                           .z.i(pid) .z.x(arg) .z.e(env)     
                                                                
Verb                       Adverb                Noun            Atom List     
:  assign                  '  each               char  " ab"       `c `C       
+  add         flip        /  over               name  ``a`b       `n `N       
-  subtract    negate      \  scan               int   Ø 0 2       `i `I      
*  multiply    first       ': eachprior          float ø 2.3 π ∞   `f `F   
%  divideby    inverse     /: eachright join|sv  time 12:34:56.789 `t `T   .z.t
&  min|and     where       \: eachleft split|vs  date 2019-06-28   `D `D   .z.D
|  max|or      reverse                                                         
<  less        ascend      System                list (2;3.4;`c)   `           
>  more        descend     0: read/write line    dict {a:2;b:`c}   `a `A(table)
=  equal       group       1: read/write byte    func {(+/x)%#x}   `1..9       
~  match       not         2: read/write data    expr  :32+9*f%5   `0          
!  key         enumerate   3: conn/set (.z.ms)                                 
,  catenate    list        4: http/get (.z.mg)   \h      help          \l log  
^  except      null                              \l f.k  load                  
#  take        count       #[t;c;b[;a]] select   \t[:n]x time                  
_  drop        floor       _[t;c;b[;a]] update   \u[:n]x trace                 
?  find        distinct    ?[x;i;f[;y]] splice   \v [d]  vars                  
@  index       type        @[x;i;f[;y]] amend    \f [d]  fns                   
.  apply       eval        .[x;i;f[;y]] dmend    \cd [d] get[set]dir   \gr grep
$  pad|cast    string      $[c;t;f]     cond     \lf [x] file \lc char \ll line
                                                                                
util: in within bin like find [f]asc [f]desc [f]key                            
math: sqrt sin cos abs prm cmb [n]log [n]exp [n]rand mod div                   
aggr: count first last min max sum avg var dev med                             
sql: [select|update|delete] a.. by b.. from t.. where c..                      
                                                                                
datetime:YMDHRSTUV+duration:ymdhrstuv; T:.z.D+.z.t; 2019-06-28+2m; day:7 mod   
`year`month`date`hour`minute`second`millisecond`microsecond`nanosecond         
                                                                                
bool: `utf8`ascii`print                                                        
1way: `p`m`crc`sha`rip`bad   e.g. hash:  `sha@"crypto"                         
2way:``j`k`csv`b64`hex`aes   e.g. json: `j?`j@{a:2;b:`c}                       
                                                                                
if[c;..];while[c;..]                                                           
                                                                                
\\ exit</pre>

</div>

<div id="detail">

    <h2 id="verbs">Verbs</h2>

    <!-- <h3 id="template"></h3><pre></pre> -->
    <h3 id="group">Group</h3>
    <p>With a list, get back the indices at which each unique element appears:
    <pre> ="abracadabra"
a|0 3 5 7 10
b|1 8       
c|,4        
d|,6        
r|2 9</pre>
    <h3 id="enumerate">Enumerate</h3><pre> !3
0 1 2
 !2 3
(0 0 0 1 1 1;0 1 2 0 1 2)</pre>
    <h3 id="key">Key</h3>
    <pre> ! {a:1;b:2}
`a`b</pre>
    <h3 id="join">Join</h3>
    <pre> "-"/:("abc";"def")
"abc-def"</pre>

    <h2 id="adverbs">Adverbs</h2>

    <h3 id="split">Split</h3>
    <pre> "-"\:"who-what-when-where-why"
who  
what 
when 
where
why</pre>

    <h2 id="util-math-aggr">Util, math, aggr</h2>

    <h3 id="[f]asc">Sort ascending <code>asc</code></h3>

    <pre> asc "abracadabra"
"aaaaabbcdrr"</pre>

    <h3 id="[f]desc">Sort descending <code>desc</code></h3>

    <pre> desc "abracadabra"
"rrdcbbaaaaa"</pre>

    <h2 id="tables-KSQL">Tables and KSQL</h2>
    
    <h3 id="table">Tables</h3>

    <p>A table is a list of dicts where each dict has the same keys in the same order.</p>
    
    <p>A table can also be considered as a flipped dict of lists, where each list is of equal length.</p>

    <pre>t: ({a:1;b:2};{a:3;b:4})   / Row-wise
u: +`a`b !    (1 3;2 4)    / Col-wise (flipped dict)
v:  `a`b ! /: (1 2;3 4)    / Row-wise, but de-duplicate headers using eachright

/ The tables match:
t~u
t~v

/ Break row-wise over multiple lines:
w: ({a:1;b:2}
    {a:3;b:4})

t~w

/ Break row-wise (condensed row format) over multiple lines:
x: `a`b!/:(1 2
           3 4)

t~x</pre>

<p>You can access rows or columns of the table by indexing using the row number or column key:</p>

<pre>t[1]    / {a:3;b:4}
t[`b]    / 2 4
t[1;`a]  / 3</pre>

<p>Key tables are dictionaries where the rows of one table map to the rows of another table.</p>

<pre>k: ({a:1;c:3}
    {a:4;c:6})
v: ({b:2};{b:5})
kt: k!v
kt   / (+{a:1 4;c:3 6})!+{b:2 5}
@kt  / `a</pre>

<p>You can also use <code>key</code> to set the key columns after creation:</p>

<pre> t: ({a:1;b:2;c:3};{a:4;b:5;c:6})
 tk: `a`c key t
 tk~kt  / 1</pre>

<p>Access rows of the value table by indexing into the keytable:</p>

<pre>kt[{a:4;c:6}]  / {b:5}</pre>

    <h3 id="expr">exprs</h3>
    <p>WIP. See <a href="https://groups.google.com/d/msg/shaktidb/5N6VjsOBjoA/GjFgeP4yDAAJ">this forum post</a>.</p>

    <h2 id="commands">Commands</h2>

    <h3 id="help">Help <code>\h</code></h3>

    <p>The official help included in the k binary. It's the navigation to this site!</p>

    <h2 id="IO-IPC">IO and IPC</h2>

    <h3 id="line">Read/write line <code>0:</code></h3>

    <!-- TODO what about writing to CSV? -->
    <p>Given the following in <code>test.csv</code>:</p>
    <pre>1,ABC,1.23
3,DEF,4567.89</pre>

    <p>We can read it in as lists of type <code>inf</code> respectively and separator <code>,</code>:</p>

    <pre> ("inf";",")0:"test.csv"
1 3         
`ABC`DEF    
1.23 4567.89</pre>

    <h3 id="byte">Read/write bytes <code>1:</code></h3>

    <pre> "testfile" 1: 0x0123456789abcdef
 1: "testfile"
0x0123456789abcdef</pre>

    <p>You can verify <code>1:</code> works with raw bytes using an external tool:</p>
 
    <pre>$ hexdump -C testfile
00000000  01 23 45 67 89 ab cd ef                           |.#Eg....|
00000008</pre>

    <h3 id="data">Read/write data <code>2:</code></h3>

    <pre> "testfile" 2: (1 2 3 4)
 2: "testfile"
1 2 3 4</pre>

    <p>You can see what <code>testfile</code> looks like in bytes with <code>1:</code>:</p>

    <pre> 1: "testfile"
0x000000070400000001000000020000000300000004000000</pre>

    <h3 id="conn">Inter-process communication <code>3:</code> and <code>4:</code></h3>

    <p>Start a k process running with port 1234 (that's <code>k -p 1234</code>).</p>

    <p>Then in another k process, set up a connection to the first k process, send it commands, and get responses:</p>

    <pre>2019-04-18 15:45:55 2core 1gb avx2 © shakti l2.0 test
 conn: 3: 1234
 conn 4: "life: 42"
 conn 4: "life"
42</pre>

    <h2 id="multi-args">3+ arguments</h2>

    <h3 id="select">Select <code>#[t;c;b[;a]]</code></h3>

    <p>Get all rows of <code>t</code> where <code>c</code> is true.</p>

    <pre> t: +`a`b!(1 2 3;4 5 6)
 #[t; :a>1]
a b
- -
2 5
3 6
 #[t; :(a>1)&(b<6)]
,{a:2;b:5}
 #[t; :(a>1)&(b<5)]
+{a:!0;b:!0}</pre>

    <h3 id="splice">Splice <code>?[x;i;f[;y]]</code></h3>

    <p>Insert <code>y</code> into <code>x</code> at index <code>i</code>.</p>
    
    <p>If an element was at that index before, move it right.</p>

    <pre> ?[!3;2;`abc]
0   
1   
`abc
2  
 ?[!3;2;"abc"]
0  
1  
"a"
"b"
"c"
2  
</pre>

    <h3 id="amend">Amend <code>@[x;i;f[;y]]</code></h3>

    <p>Replace the element at <code>i</code> in <code>x</code> with <code>y</code>.</p>

    <pre> @[!3;2;`abc]
0   
1   
`abc</pre>

    <h3 id="within">Within</h3>

    <pre> `p within `A`z
1
 `p within `A`Z
0</pre>

    <h3 id="`ascii"><code>`ascii</code></h4>

    <p>Are all characters in the string in the <a href="https://en.wikipedia.org/wiki/ASCII#Character_set">ASCII set</a>?</p>
    <pre> `ascii @ "123"
1
 `ascii @ "∞"
0</pre>

<h3 id="`print"><code>`print</code></h4>

<p>Are all characters in the string printable?</p>
<pre> `print @ "123"
1
 `print @ "123\n"
0
 `print @ "∞"
1</pre>

<h2 id="datetimes">Datetimes</h2>

<p>Dates start from <code>2024-01-01</code>:</p>

<pre>`D $ 0
2024-01-01</pre>

<p>'0' is Monday. Get the day of the week with <code>7 mod</code>.</p>

<pre> `Mon`Tue`Wed`Thu`Fri`Sat`Sun @ 7 mod 2024-01-01
`Mon</pre>

<h3 id=".z.D">Current date <code>.z.D</code></h3>
<pre>.z.D / 2019-04-02</pre>

<h3 id=".z.t">Current time <code>.z.t</code></h3>
<p>Greenwich Mean Time.</p>

<pre>.z.t / 11:18:14.857</pre>

<h2 id="converters">Converters</h2>

<h3 id="1way">One-way conversions</h3>

<h4>Parse <code>`p</code></h4>

<pre> `p @ "5*!3"
*     
5     
(!:;3)</pre>

<p>A parse tree can be executed with <code>.</code>:</p>

<pre> . `p @ "5*!3"
0 5 10</pre>

<p>Although parse trees can be converted into strings with <code>`p ?</code>, it is not a lossless conversion.</p>

<p>The parser enlists names (and lists of names) to indicate they should not be evaluated.</p>

<p>Examples:</p>

<pre> e: ("1;.1;`n;\"c\";1 2;1. 2.;`n`o;\"chars\";v;1+2;+/1 2;{x+2y};a:1;:a+2b;/comment;\\h")
 {{string: x; parsetree: `p x; type: @ `p x}}' ";"\: e
string   parsetree    type
-------- ------------ ----
1        1            i   
.1       0.1          f   
`n       ,`n          N   
"c"      "c"          c   
1 2      1 2          I   
1. 2.    1 2f         F   
`n`o     ,`n`o            
"chars"  "chars"      C   
v        `v           n   
1+2      (+;1;2)          
+/1 2    ((/;+);1 2)      
{x+2y}   {x+2y}       1   
a:1      (::;`a;1)        
:a+2b    :a+2b        0   
/comment (/;`comment)     
\h       (\;`h)</pre>

<!-- TODO: add IO functions like -p, .z.ms, .z.mg -->

<h4>Matrix display <code>`m</code></h4>

<pre>d: 1 2 3
d
1 2 3
`m d
1
2
3</pre>

    <h3 id="2way">Two-way conversions</h3>

    <p>Convert to with <code>`x@data</code> or <code>`x data</code>, where `x is the relevant name.</p>

    <p>Convert from with <code>`x?serialdata</code>.</p>

    <h4>Binary <code>`</code></h4>
    <pre> ` "a"
0x0161
 ` `a
0x0f6100
 ` 10
0x070a000000</pre>

    <h4>JSON <code>`j</code></h4>

    <pre> `j ({a:1;b:2};{a:"x";b:`z})
"[{\"a\":1,\"b\":2},{\"a\":\"x\",\"b\":\"z\"}]"</pre>

    <h4>KSON <code>`k</code></h4>

    <pre> `k 2*!3
"0 2 4"
 `k ({a:1;b:2};{a:"x";b:`z})
"+{a:(1;\"x\");b:(2;`z)}"</pre>

<h3 id="faq">FAQ</h3>

<h4>How do I see the output of an assignment expression?</h4>

<p>Use the identity function, <code>::</code>:</p>

<pre> a:1+2  / no output
 :: a:1+2
3
 @(::)
`1</pre>

<h4>How do I make an empty typed list?</h4>

<p>For characters, it's just <code>""</code>:</p>

<pre> #""
0
 @""
`C</pre>

<p>For integers and floats, use <code>!</code>:</p>

<pre> @!0
`I
 #!0
0
 @!.0
`F
 #!.0
0</pre>

<p>For other types, take 0 elements from a list of that type (may be a better way?). For names:</p>

<pre> 0#(,`)

 @0#(,`)
`N
 #0#(,`)
0</pre>

<!-- TODO suggestions: summary of date handling, maybe some crypto examples would be interesting, differences from q (a complex subject) -->
<!-- TODO https://groups.google.com/d/msg/shaktidb/UKZcbwN-qiA/i3LtReSPCwAJ -->
<!-- TODO file and network i/o would be cool too :) -->
<!-- TODO bringing in typed cols from CSVs -->
<!-- TODO stuff from changelog that's not in help -->

<h3 id="shakti-python">shakti-python</h3>

<h4>Install</h4>

<p>One way to install shakti-python is to use <a href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html">Miniconda</a>.</p>

<p>To install Miniconda under Ubuntu 18.04:</p>
<ul>
    <li>Download the Miniconda installer for Python 3, 64-bit (<a href="https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh">direct link</a>)</li>
    <li>In a terminal in your download directory, run:<br><code>bash Miniconda3-latest-Linux-x86_64.sh</code>
</ul>

<p>Once Miniconda is installed, open a new terminal and run:<br><code>conda install -c shaktidb shakti-python</code>.</p>
<p>Then to get to shakti-python, at the prompt, run <code>python</code> <br>(or if you chose to not update your .bashrc, <code>~/miniconda3/bin/python</code>).</p>

<p>Type <code>help('shakti')</code> at the Python prompt to view the package help.</p>

<pre>(base) chris@chris-VirtualBox:~$ python
Python 3.7.1 (default, Dec 14 2018, 19:28:38) 
[GCC 7.3.0] :: Anaconda, Inc. on linux
Type "help", "copyright", "credits" or "license" for more information.
>>>      
>>> import shakti
>>> 
>>> # Execute k commands:
... a = shakti.k("!3")
>>> a
k('!3')
>>> 
>>> a.  # press tab twice for auto-completion (have truncated output)
a.append(    a.cat(       a.distinct(  a.eq(        a.first(     a.group( ...
a.apply(     a.clear(     a.dsc(       a.eval(      a.flip(      a.iasc(  ...
a.asc(       a.count(     a.enlist(    a.extend(    a.floor(     a.idesc( ...
>>> 
>>> # shakti functions and object methods can take Python objects directly:
... a.cat((1, 2, 3))
k('0 1 2 1 2 3')
>>> b = a.cat((1, 2, 3)).where
>>> b
k('1 2 2 3 4 4 5 5 5')
>>> sum(b)
k('31')
>>>
>>> # User-facing module API:
... shakti.__all__
['q', 'k', 'o', 'flip', 'neg', 'sqrt', 'enum', 'parse', 'where', 'reverse',
'count', 'first', 'last', 'sum', 'min', 'max', 'avg', 'var', 'iasc', 'idesc',
'group', 'not_', 'enlist', 'null', 'floor', 'string', 'distinct', 'type_',
'eval_', 'apply', 'at', 'rand', 'find', 'cast', 'take', 'shape', 'match',
'cat', 'drop', 'cut', 'log', 'exp', 'sin', 'cos', 'first', 'last', 'error',
'Ø', 'ø', 'inf', 'show']
>>> 
>>> # Convert Python objects to k:
... shakti.o(range(10))
k('!10')
>>> # o is equivalent to k's identity function:
... shakti.o == shakti.k('::')
True
>>>
>>> # Add globals to k:
... shakti.q.a = [1,2,3]
>>> shakti.k("a*2")
k('2 4 6')
>>> shakti.q.a * 2
k('2 4 6')
>>>
>>> # REPL: shakti.k_repl(), or just...
... /
 +/ 1 2 3
6
 \\
>>></pre>

<p>shakti-python also lets you do some things that k doesn't:</p>
<ul>
    <li><a href="https://groups.google.com/d/msg/shaktidb/etsXDI9J4o4/HmefTXyBAwAJ">Delete globals</a> (at your peril!)</li>
    <li><a href="https://groups.google.com/d/msg/shaktidb/lQ3XSvFPDhw/DOlmmFgHDAAJ">Catch errors</a></li>
</ul>

<h2 id="communities">Communities</h2>
<ul>
    <li><a href="https://groups.google.com/forum/#!forum/shaktidb">shakti google group</a> (official - for 'how to' queries)</li>
    <li><a href="https://chat.stackexchange.com/rooms/90748/the-k-tree">the k tree</a> <br>  write access: email <code>".@acegiklmnort"@7 13 12 4 4 0 10 5 10 1 5 9 2 6 8 0 3 11 9</code></li>
    <li><a href="https://www.reddit.com/r/apljk/">r/apljk</a></li>
</ul>

</div>

<script>

    const raw_elem = document.getElementById("official-help")
    function makeLink(word) {
        return "<a href=\"#" + word + "\">" + word + "</a>"
    }

    links = ["group", "enumerate", "key", "join", "split", "table", ".z.D", ".z.t", "expr", "help", "[f]asc", "[f]desc", "line", "byte", "data", "conn", "select", "splice", "amend", "within", "`ascii", "`print", "datetime", "1way", "2way"]

    for (let i in links) {
        const w = links[i]
        raw_elem.innerHTML = raw_elem.innerHTML.replace(w, makeLink(w))
    }
    
</script>

<!-- misc notes

bad is bitcoin address:
https://groups.google.com/d/msg/shaktidb/0yq21rHOacU/QqgeStO-CgAJ

table generation:
select a:x,b:1+2*x from +[!3]
{;[a:x;b:1+2*x]}' !3
-->

<!--
<h3 id=".z.f">Recursion <code>.z.f</code></h3>
<p>Use in a function definition to refer to the current function.</p>
<pre> factorial: {$[x<2;1;x*.z.f[x-1]]}
factorial 4
24
/ Better: {*/1+!x}</pre>
-->

<!--
        <p>With a positive integer, generate an identity matrix:</p>
    <pre> =3
1 0 0
0 1 0
0 0 1</pre>
-->

</body>

</html>
